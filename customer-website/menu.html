<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Menu</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f4; color: #333; }
        .container { max-width: 800px; margin: 20px auto; padding: 20px; background-color: #fff; border-radius: 8px; }
        h1, h2 { text-align: center; }
        nav { text-align: center; margin-bottom: 20px; }
        nav a { margin: 0 15px; text-decoration: none; color: #007bff; font-weight: bold;}
        .menu-item { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding: 15px 0; }
        .menu-item-details h3 { margin: 0; }
        .menu-item-details p { margin: 5px 0; color: #666; }
        .price { font-weight: bold; }
        .add-btn { background-color: #28a745; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; }
        #cart { margin-top: 30px; border-top: 2px solid #333; padding-top: 20px; }
        #cart-items li { display: flex; justify-content: space-between; margin-bottom: 10px; }
        #place-order-btn { display: block; width: 100%; padding: 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 1.2em; cursor: pointer; margin-top: 20px; }
        #order-message { text-align: center; margin-top: 15px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Our Menu</h1>
        <nav>
            <a href="index.html">Change Location</a>
            <a href="signup.html">Sign Up</a>
        </nav>
        <div id="menu-container">
            <!-- Menu items will be loaded here -->
        </div>

        <div id="cart">
            <h2>Your Order</h2>
            <ul id="cart-items">
                <!-- Cart items will be loaded here -->
            </ul>
            <h3 id="total-price">Total: $0.00</h3>
            <button id="place-order-btn">Place Order</button>
            <div id="order-message"></div>
        </div>
    </div>

    <script>
        let cart = [];
        let locationId = null;

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            locationId = urlParams.get('location_id');
            const menuContainer = document.getElementById('menu-container');

            if (!locationId) {
                menuContainer.innerHTML = '<p>No location selected. Please <a href="index.html">go back</a>.</p>';
                return;
            }

            fetch(`http://127.0.0.1:5000/api/menu/${locationId}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(item => {
                        const menuItemDiv = document.createElement('div');
                        menuItemDiv.className = 'menu-item';
                        
                        menuItemDiv.innerHTML = `
                            <div class="menu-item-details">
                                <h3>${item.name}</h3>
                                <p>${item.description}</p>
                                <p class="price">$${item.price}</p>
                            </div>
                            <button class="add-btn" onclick="addToCart(${item.id}, '${item.name}', ${item.price})">Add to Cart</button>
                        `;
                        menuContainer.appendChild(menuItemDiv);
                    });
                });
        });

        function addToCart(itemId, name, price) {
            const existingItem = cart.find(item => item.id === itemId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({ id: itemId, name: name, price: price, quantity: 1 });
            }
            updateCartDisplay();
        }

        function updateCartDisplay() {
            const cartItemsUl = document.getElementById('cart-items');
            const totalPriceEl = document.getElementById('total-price');
            let total = 0;
            
            cartItemsUl.innerHTML = ''; 

            cart.forEach(item => {
                const li = document.createElement('li');
                li.textContent = `${item.name} x${item.quantity}`;
                const span = document.createElement('span');
                span.textContent = `$${(item.price * item.quantity).toFixed(2)}`;
                li.appendChild(span);
                cartItemsUl.appendChild(li);
                total += item.price * item.quantity;
            });

            totalPriceEl.textContent = `Total: $${total.toFixed(2)}`;
        }
        
        document.getElementById('place-order-btn').addEventListener('click', function() {
            const messageDiv = document.getElementById('order-message');
            messageDiv.textContent = '';
            
            if (cart.length === 0) {
                alert("Your cart is empty!");
                return;
            }
            
            const orderData = {
                locationId: parseInt(locationId),
                items: cart
                // customerId could be added here later
            };

            fetch('http://127.0.0.1:5000/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(orderData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Success:', data);
                messageDiv.textContent = `Order placed successfully! Your order ID is ${data.orderId}.`;
                messageDiv.style.color = 'green';
                cart = []; // Clear the cart
                updateCartDisplay(); // Update the display
            })
            .catch(error => {
                console.error('Error:', error);
                messageDiv.textContent = 'Error placing order. Please try again.';
                messageDiv.style.color = 'red';
            });
        });

    </script>
</body>
</html>

