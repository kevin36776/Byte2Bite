<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Front of House - Order Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #343a40;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        .dashboard-container {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .dashboard-column {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            flex-grow: 1;
            min-width: 300px;
            max-width: 30%;
        }
        .dashboard-column h2 {
            text-align: center;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .order-card {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .order-card-header {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .order-card-body ul {
            list-style: none;
            padding: 0;
            margin: 0 0 10px 0;
        }
        .order-card-footer {
            margin-top: 15px;
        }
        .action-btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            color: white;
            font-size: 1em;
            cursor: pointer;
        }
        .btn-pickup { background-color: #28a745; }
        .status-tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-size: 0.9em;
        }
        .status-pending { background-color: #ffc107; color: #212529; }
        .status-preparing { background-color: #007bff; }
        .status-completed { background-color: #17a2b8; }
    </style>
</head>
<body>

    <h1>FOH Order Dashboard</h1>
    <div class="dashboard-container">
        <div class="dashboard-column">
            <h2>In Progress</h2>
            <div id="inprogress-orders">
                <!-- Pending and Preparing orders will appear here -->
            </div>
        </div>
        <div class="dashboard-column">
            <h2>Ready to Bag</h2>
            <div id="completed-orders">
                <!-- Completed orders will appear here -->
            </div>
        </div>
    </div>

    <script>
        const apiBaseUrl = 'http://127.0.0.1:5000';

        function createOrderCard(order) {
            const card = document.createElement('div');
            card.className = 'order-card';

            let itemsHtml = '<ul>';
            order.items.forEach(item => {
                itemsHtml += `<li>${item.quantity}x ${item.name}</li>`;
            });
            itemsHtml += '</ul>';
            
            let statusHtml = `<span class="status-tag status-${order.status.toLowerCase()}">${order.status}</span>`;
            let actionsHtml = '';

            // FOH can mark an order as "Ready for Pickup" only after the kitchen has "Completed" it.
            if (order.status === 'Completed') {
                actionsHtml = `<button class="action-btn btn-pickup" onclick="updateOrderStatus(${order.orderId}, 'Ready for Pickup')">Ready for Pickup</button>`;
            }

            card.innerHTML = `
                <div class="order-card-header">
                    <span>Order #${order.orderId}</span> - <span>${order.restaurantName}</span>
                </div>
                <div class="order-card-body">
                    ${itemsHtml}
                </div>
                <div class="order-card-footer">
                    ${statusHtml}
                    ${actionsHtml}
                </div>
            `;
            return card;
        }

        function fetchAndDisplayOrders() {
            const inProgressColumn = document.getElementById('inprogress-orders');
            const completedColumn = document.getElementById('completed-orders');

            fetch(`${apiBaseUrl}/api/orders/active`)
                .then(response => response.json())
                .then(data => {
                    inProgressColumn.innerHTML = '';
                    completedColumn.innerHTML = '';

                    data.forEach(order => {
                        const card = createOrderCard(order);
                        if (order.status === 'Pending' || order.status === 'Preparing') {
                            inProgressColumn.appendChild(card);
                        } else if (order.status === 'Completed') {
                            completedColumn.appendChild(card);
                        }
                    });
                })
                .catch(error => console.error('Error fetching orders:', error));
        }

        function updateOrderStatus(orderId, newStatus) {
            fetch(`${apiBaseUrl}/api/orders/${orderId}/status`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ status: newStatus }),
            })
            .then(response => response.json())
            .then(data => {
                console.log(data.message);
                fetchAndDisplayOrders(); // Refresh the display
            })
            .catch(error => console.error('Error updating status:', error));
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetchAndDisplayOrders();
            setInterval(fetchAndDisplayOrders, 5000); // Refresh faster for FOH
        });
    </script>
</body>
</html>

